import{v as he,r as p,w as ge,_ as L,j as s,b,d as A,x as be,y as Z,z as O,A as ye,E as ve,F as xe,f as T,a as z,G as Ce,H as X,g as U,s as F,e as I,J as ke,K as H,u as V,m as N,h as ne,M as Re,N as je,O as Pe,k as Se,Q as we,q as Fe,B as E,C as Y,P as $e,D as Be,p as Me}from"./index-Bxr5mO_H.js";import{u as Ne}from"./notistack.esm-2ii-TFc-.js";import{A as ee}from"./Alert-CSFYCpaa.js";import{L as Ae}from"./LinearProgress-xs9CA9qh.js";import{T as Ie}from"./TextField-C5nTOOG9.js";import{u as ae}from"./useControlled-BWtu2dAB.js";import{u as Q,f as le}from"./Select-DZCMXPxL.js";import{R as Le}from"./Rating-JvCGMI0H.js";import"./useSlot-CL1GQppj.js";const Te=["component","direction","spacing","divider","children","className","useFlexGap"],ze=Ce(),Ge=he("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,o)=>o.root});function Ee(e){return be({props:e,name:"MuiStack",defaultTheme:ze})}function De(e,o){const n=p.Children.toArray(e).filter(Boolean);return n.reduce((t,l,i)=>(t.push(l),i<n.length-1&&t.push(p.cloneElement(o,{key:`separator-${i}`})),t),[])}const Ue=e=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[e],Ve=({ownerState:e,theme:o})=>{let n=b({display:"flex",flexDirection:"column"},Z({theme:o},O({values:e.direction,breakpoints:o.breakpoints.values}),t=>({flexDirection:t})));if(e.spacing){const t=ye(o),l=Object.keys(o.breakpoints.values).reduce((d,a)=>((typeof e.spacing=="object"&&e.spacing[a]!=null||typeof e.direction=="object"&&e.direction[a]!=null)&&(d[a]=!0),d),{}),i=O({values:e.direction,base:l}),v=O({values:e.spacing,base:l});typeof i=="object"&&Object.keys(i).forEach((d,a,R)=>{if(!i[d]){const y=a>0?i[R[a-1]]:"column";i[d]=y}}),n=ve(n,Z({theme:o},v,(d,a)=>e.useFlexGap?{gap:X(t,d)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Ue(a?i[a]:e.direction)}`]:X(t,d)}}))}return n=xe(o.breakpoints,n),n};function _e(e={}){const{createStyledComponent:o=Ge,useThemeProps:n=Ee,componentName:t="MuiStack"}=e,l=()=>T({root:["root"]},d=>z(t,d),{}),i=o(Ve);return p.forwardRef(function(d,a){const R=n(d),h=ge(R),{component:y="div",direction:x="column",spacing:j=0,divider:P,children:g,className:C,useFlexGap:m=!1}=h,w=L(h,Te),c={direction:x,spacing:j,useFlexGap:m},u=l();return s.jsx(i,b({as:y,ownerState:c,ref:a,className:A(u.root,C)},w,{children:P?De(g,P):g}))})}function Oe(e){return z("PrivateSwitchBase",e)}U("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const qe=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],We=e=>{const{classes:o,checked:n,disabled:t,edge:l}=e,i={root:["root",n&&"checked",t&&"disabled",l&&`edge${I(l)}`],input:["input"]};return T(i,Oe,o)},He=F(ke,{name:"MuiSwitchBase"})(({ownerState:e})=>b({padding:9,borderRadius:"50%"},e.edge==="start"&&{marginLeft:e.size==="small"?-3:-12},e.edge==="end"&&{marginRight:e.size==="small"?-3:-12})),Qe=F("input",{name:"MuiSwitchBase",shouldForwardProp:H})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Je=p.forwardRef(function(o,n){const{autoFocus:t,checked:l,checkedIcon:i,className:v,defaultChecked:f,disabled:d,disableFocusRipple:a=!1,edge:R=!1,icon:h,id:y,inputProps:x,inputRef:j,name:P,onBlur:g,onChange:C,onFocus:m,readOnly:w,required:c=!1,tabIndex:u,type:r,value:k}=o,S=L(o,qe),[$,ue]=ae({controlled:l,default:!!f,name:"SwitchBase",state:"checked"}),M=Q(),de=B=>{m&&m(B),M&&M.onFocus&&M.onFocus(B)},pe=B=>{g&&g(B),M&&M.onBlur&&M.onBlur(B)},me=B=>{if(B.nativeEvent.defaultPrevented)return;const K=B.target.checked;ue(K),C&&C(B,K)};let G=d;M&&typeof G>"u"&&(G=M.disabled);const fe=r==="checkbox"||r==="radio",_=b({},o,{checked:$,disabled:G,disableFocusRipple:a,edge:R}),J=We(_);return s.jsxs(He,b({component:"span",className:A(J.root,v),centerRipple:!0,focusRipple:!a,disabled:G,tabIndex:null,role:void 0,onFocus:de,onBlur:pe,ownerState:_,ref:n},S,{children:[s.jsx(Qe,b({autoFocus:t,checked:l,defaultChecked:f,className:J.input,disabled:G,id:fe?y:void 0,name:P,onChange:me,readOnly:w,ref:j,required:c,ownerState:_,tabIndex:u,type:r},r==="checkbox"&&k===void 0?{}:{value:k},x)),$?i:h]}))}),Ke=_e({createStyledComponent:F("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,o)=>o.root}),useThemeProps:e=>V({props:e,name:"MuiStack"})});function Ze(e){return z("MuiFormControlLabel",e)}const D=U("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Xe=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],Ye=e=>{const{classes:o,disabled:n,labelPlacement:t,error:l,required:i}=e,v={root:["root",n&&"disabled",`labelPlacement${I(t)}`,l&&"error",i&&"required"],label:["label",n&&"disabled"],asterisk:["asterisk",l&&"error"]};return T(v,Ze,o)},eo=F("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:n}=e;return[{[`& .${D.label}`]:o.label},o.root,o[`labelPlacement${I(n.labelPlacement)}`]]}})(({theme:e,ownerState:o})=>b({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${D.disabled}`]:{cursor:"default"}},o.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},o.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},o.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${D.label}`]:{[`&.${D.disabled}`]:{color:(e.vars||e).palette.text.disabled}}})),oo=F("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,o)=>o.asterisk})(({theme:e})=>({[`&.${D.error}`]:{color:(e.vars||e).palette.error.main}})),q=p.forwardRef(function(o,n){var t,l;const i=V({props:o,name:"MuiFormControlLabel"}),{className:v,componentsProps:f={},control:d,disabled:a,disableTypography:R,label:h,labelPlacement:y="end",required:x,slotProps:j={}}=i,P=L(i,Xe),g=Q(),C=(t=a??d.props.disabled)!=null?t:g?.disabled,m=x??d.props.required,w={disabled:C,required:m};["checked","name","onChange","value","inputRef"].forEach($=>{typeof d.props[$]>"u"&&typeof i[$]<"u"&&(w[$]=i[$])});const c=le({props:i,muiFormControl:g,states:["error"]}),u=b({},i,{disabled:C,labelPlacement:y,required:m,error:c.error}),r=Ye(u),k=(l=j.typography)!=null?l:f.typography;let S=h;return S!=null&&S.type!==N&&!R&&(S=s.jsx(N,b({component:"span"},k,{className:A(r.label,k?.className),children:S}))),s.jsxs(eo,b({className:A(r.root,v),ownerState:u,ref:n},P,{children:[p.cloneElement(d,w),m?s.jsxs(Ke,{display:"block",children:[S,s.jsxs(oo,{ownerState:u,"aria-hidden":!0,className:r.asterisk,children:["â€‰","*"]})]}):S]}))});function to(e){return z("MuiFormGroup",e)}U("MuiFormGroup",["root","row","error"]);const so=["className","row"],ro=e=>{const{classes:o,row:n,error:t}=e;return T({root:["root",n&&"row",t&&"error"]},to,o)},no=F("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:n}=e;return[o.root,n.row&&o.row]}})(({ownerState:e})=>b({display:"flex",flexDirection:"column",flexWrap:"wrap"},e.row&&{flexDirection:"row"})),ao=p.forwardRef(function(o,n){const t=V({props:o,name:"MuiFormGroup"}),{className:l,row:i=!1}=t,v=L(t,so),f=Q(),d=le({props:t,muiFormControl:f,states:["error"]}),a=b({},t,{row:i,error:d.error}),R=ro(a);return s.jsx(no,b({className:A(R.root,l),ownerState:a,ref:n},v))}),lo=ne(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),io=ne(s.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),co=F("span",{name:"MuiRadioButtonIcon",shouldForwardProp:H})({position:"relative",display:"flex"}),uo=F(lo,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),po=F(io,{name:"MuiRadioButtonIcon"})(({theme:e,ownerState:o})=>b({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest})},o.checked&&{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}));function ie(e){const{checked:o=!1,classes:n={},fontSize:t}=e,l=b({},e,{checked:o});return s.jsxs(co,{className:n.root,ownerState:l,children:[s.jsx(uo,{fontSize:t,className:n.background,ownerState:l}),s.jsx(po,{fontSize:t,className:n.dot,ownerState:l})]})}const ce=p.createContext(void 0);function mo(){return p.useContext(ce)}function fo(e){return z("MuiRadio",e)}const oe=U("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),ho=["checked","checkedIcon","color","icon","name","onChange","size","className"],go=e=>{const{classes:o,color:n,size:t}=e,l={root:["root",`color${I(n)}`,t!=="medium"&&`size${I(t)}`]};return b({},o,T(l,fo,o))},bo=F(Je,{shouldForwardProp:e=>H(e)||e==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:n}=e;return[o.root,n.size!=="medium"&&o[`size${I(n.size)}`],o[`color${I(n.color)}`]]}})(({theme:e,ownerState:o})=>b({color:(e.vars||e).palette.text.secondary},!o.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${o.color==="default"?e.vars.palette.action.activeChannel:e.vars.palette[o.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:je.alpha(o.color==="default"?e.palette.action.active:e.palette[o.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${oe.checked}`]:{color:(e.vars||e).palette[o.color].main}},{[`&.${oe.disabled}`]:{color:(e.vars||e).palette.action.disabled}}));function yo(e,o){return typeof o=="object"&&o!==null?e===o:String(e)===String(o)}const te=s.jsx(ie,{checked:!0}),se=s.jsx(ie,{}),W=p.forwardRef(function(o,n){var t,l;const i=V({props:o,name:"MuiRadio"}),{checked:v,checkedIcon:f=te,color:d="primary",icon:a=se,name:R,onChange:h,size:y="medium",className:x}=i,j=L(i,ho),P=b({},i,{color:d,size:y}),g=go(P),C=mo();let m=v;const w=Re(h,C&&C.onChange);let c=R;return C&&(typeof m>"u"&&(m=yo(C.value,i.value)),typeof c>"u"&&(c=C.name)),s.jsx(bo,b({type:"radio",icon:p.cloneElement(a,{fontSize:(t=se.props.fontSize)!=null?t:y}),checkedIcon:p.cloneElement(f,{fontSize:(l=te.props.fontSize)!=null?l:y}),ownerState:P,classes:g,name:c,checked:m,onChange:w,ref:n,className:A(g.root,x)},j))});function vo(e){return z("MuiRadioGroup",e)}U("MuiRadioGroup",["root","row","error"]);const xo=["actions","children","className","defaultValue","name","onChange","value"],Co=e=>{const{classes:o,row:n,error:t}=e;return T({root:["root",n&&"row",t&&"error"]},vo,o)},re=p.forwardRef(function(o,n){const{actions:t,children:l,className:i,defaultValue:v,name:f,onChange:d,value:a}=o,R=L(o,xo),h=p.useRef(null),y=Co(o),[x,j]=ae({controlled:a,default:v,name:"RadioGroup"});p.useImperativeHandle(t,()=>({focus:()=>{let m=h.current.querySelector("input:not(:disabled):checked");m||(m=h.current.querySelector("input:not(:disabled)")),m&&m.focus()}}),[]);const P=Pe(n,h),g=Se(f),C=p.useMemo(()=>({name:g,onChange(m){j(m.target.value),d&&d(m,m.target.value)},value:x}),[g,d,j,x]);return s.jsx(ce.Provider,{value:C,children:s.jsx(ao,b({role:"radiogroup",ref:P,className:A(y.root,i)},R,{children:l}))})});function ko(){const{assessmentId:e}=we(),[o,n]=p.useState(null),[t,l]=p.useState({}),[i,v]=p.useState(!0),[f,d]=p.useState(!1),[a,R]=p.useState(null),{enqueueSnackbar:h}=Ne(),y=Fe(),x=p.useRef(null),j=p.useCallback(async()=>{if(f||!o)return;const u=o.questions.map((r,k)=>r.required?k:null).filter(r=>r!==null).filter(r=>t[r]===void 0||t[r]===""||Array.isArray(t[r])&&t[r].length===0);if(u.length>0&&a>1){h(`Please answer all required questions (${u.map(r=>r+1).join(", ")})`,{variant:"error"});return}d(!0),x.current&&clearInterval(x.current);try{const r=localStorage.getItem("token");if(!r)throw new Error("Authentication token not found");const k=o.timeLimitMinutes?o.timeLimitMinutes*60-a:null,S=await fetch(`/api/assessments/${e}/submit`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({answers:t,durationMinutes:k?Math.floor(k/60):null})});if(!S.ok){const $=await S.json();throw new Error($.message||"Failed to submit")}h("Assessment submitted successfully!",{variant:"success"}),y(`/assessments/${e}/results`)}catch(r){console.error("Submission error:",r),h(`Failed to submit: ${r.message}`,{variant:"error",autoHideDuration:5e3})}finally{d(!1)}},[f,o,t,a,e,h,y]),P=p.useCallback(async()=>{v(!0);try{const c=localStorage.getItem("token");if(!c)throw new Error("Authentication token not found");const u=await fetch(`/api/assessments/${e}`,{method:"GET",headers:{Authorization:`Bearer ${c}`}}),r=await u.json();if(!u.ok)throw new Error(r.message||"Assessment not found");if(n(r),r.timeLimitMinutes){const k=new Date(r.startedAt),S=new Date(k.getTime()+r.timeLimitMinutes*6e4);R(Math.max(0,Math.floor((S-new Date)/1e3)))}}catch(c){console.error("Error loading assessment:",c),h("Failed to load assessment",{variant:"error"}),y("/assessments")}finally{v(!1)}},[e,h,y]);p.useEffect(()=>{P()},[P]),p.useEffect(()=>{if(!(a===null||f))return x.current=a>0?setInterval(()=>{R(c=>c<=1?(clearInterval(x.current),j(),0):c-1)},1e3):null,()=>clearInterval(x.current)},[a,j,f]);const g=(c,u)=>{l(r=>({...r,[c]:u}))},C=c=>{const u=Math.floor(c/60),r=c%60;return`${u}:${r<10?"0":""}${r}`};if(i)return s.jsx(E,{sx:{display:"flex",justifyContent:"center",p:4},children:s.jsx(Y,{size:60})});if(!o)return s.jsx(ee,{severity:"error",sx:{m:2},children:"Assessment not found or loading failed."});const m=o.timeLimitMinutes*60,w=m>0?100-a/m*100:0;return s.jsxs($e,{elevation:2,sx:{p:3,borderRadius:2},children:[s.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[s.jsx(N,{variant:"h4",component:"h1",color:"primary",children:o.title}),a!==null&&s.jsxs(N,{variant:"h6",color:a<60?"error":"textPrimary",children:["Time Remaining: ",C(a)]})]}),s.jsx(N,{variant:"body1",paragraph:!0,children:o.description}),a!==null&&s.jsx(Ae,{variant:"determinate",value:w,color:a<60?"error":"primary",sx:{mb:3,height:8}}),s.jsx(Be,{sx:{my:3}}),o.questions.map((c,u)=>s.jsxs(E,{sx:{mb:4},children:[s.jsxs(N,{variant:"h6",gutterBottom:!0,children:[u+1,". ",c.text,c.required&&s.jsx(N,{component:"span",color:"error",sx:{ml:1},children:"* "})]}),c.type==="text"&&s.jsx(Ie,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:t[u]||"",onChange:r=>g(u,r.target.value),placeholder:"Type your answer here..."}),c.type==="multiple_choice"&&s.jsx(re,{value:t[u]||"",onChange:r=>g(u,r.target.value),children:c.options.map((r,k)=>s.jsx(q,{value:r,control:s.jsx(W,{}),label:r},`opt-${k}`))}),c.type==="rating"&&s.jsxs(E,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(Le,{value:Number(t[u])||0,onChange:(r,k)=>g(u,k),precision:1,max:5}),s.jsx(N,{variant:"body2",color:"text.secondary",children:t[u]?`${t[u]} out of 5`:"Rate here"})]}),c.type==="boolean"&&s.jsxs(re,{value:t[u]===!0?"true":t[u]===!1?"false":"",onChange:r=>g(u,r.target.value==="true"),children:[s.jsx(q,{value:"true",control:s.jsx(W,{}),label:"True"}),s.jsx(q,{value:"false",control:s.jsx(W,{}),label:"False"})]}),c.type==="file"&&s.jsx(ee,{severity:"info",sx:{mt:1},children:"File upload logic needs a dedicated API endpoint (e.g., S3 or Vercel Blob)"})]},`q-${u}`)),s.jsx(E,{sx:{display:"flex",justifyContent:"space-between",mt:4},children:s.jsx(Me,{variant:"contained",color:"primary",size:"large",onClick:j,disabled:f||a!==null&&a<=0,sx:{minWidth:180},children:f?s.jsxs(s.Fragment,{children:[s.jsx(Y,{size:24,sx:{mr:1},color:"inherit"})," Submitting..."]}):"Submit Assessment"})})]})}ko.propTypes={};export{ko as default};
