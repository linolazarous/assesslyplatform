import{h as f,j as e,r as c,q as E,P as F,m as d,D as W,L as H,n as L,B as l,I as w,p as j,C as N,t as V}from"./index-Bxr5mO_H.js";import{u as G}from"./notistack.esm-2ii-TFc-.js";import{G as u}from"./Grid-C4lt9ccn.js";import{T as p,F as C,I as S}from"./TextField-C5nTOOG9.js";import{S as Q}from"./Select-DZCMXPxL.js";import{M as g}from"./MenuItem-LevUaqkI.js";import"./useControlled-BWtu2dAB.js";const T=f(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),A=f(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),I=f(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),U=[{value:"text",label:"Text Answer"},{value:"multiple_choice",label:"Multiple Choice"},{value:"rating",label:"Rating Scale"},{value:"file",label:"File Upload"},{value:"boolean",label:"True/False"}];function J({organizationId:k}){const[h,D]=c.useState(""),[b,z]=c.useState(""),[a,o]=c.useState([{id:Date.now(),text:"",type:"text",options:[],required:!0}]),[m,y]=c.useState(!1),{enqueueSnackbar:n}=G(),O=E(),$=()=>{o([...a,{id:Date.now(),text:"",type:"text",options:[],required:!0}])},M=t=>{if(a.length<=1){n("Assessment must have at least one question",{variant:"warning"});return}o(a.filter((s,r)=>r!==t))},x=(t,s,r)=>{const i=[...a];i[t][s]=r,s==="type"&&(r!=="multiple_choice"?i[t].options=[]:r==="multiple_choice"&&i[t].options.length===0&&(i[t].options=[{id:Date.now(),text:""},{id:Date.now()+1,text:""}])),o(i)},B=t=>{const s=[...a];s[t].options=[...s[t].options,{id:Date.now(),text:""}],o(s)},P=(t,s,r)=>{const i=[...a];i[t].options[s].text=r,o(i)},R=(t,s)=>{const r=[...a];if(r[t].options.length<=2){n("Multiple choice questions require at least two options.",{variant:"warning"});return}r[t].options.splice(s,1),o(r)},_=()=>{if(!h.trim())return n("Assessment title is required",{variant:"error"}),!1;for(let t=0;t<a.length;t++){const s=a[t];if(!s.text.trim())return n(`Question ${t+1} text is required`,{variant:"error"}),!1;if(s.type==="multiple_choice"){if(s.options.length<2)return n(`Question ${t+1} needs at least 2 options`,{variant:"error"}),!1;if(s.options.some(r=>!r.text.trim()))return n(`Question ${t+1} has empty options`,{variant:"error"}),!1}}return!0},q=async()=>{if(_()){y(!0);try{const t=localStorage.getItem("token");if(!t)throw new Error("Authentication token not found");const s={title:h,description:b,organizationId:k,questions:a.map(i=>({text:i.text,type:i.type,required:i.required,options:i.type==="multiple_choice"?i.options.map(v=>v.text):[]}))},r=await fetch("/api/assessments/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(!r.ok){const i=await r.json();throw new Error(i.message||"Failed to save assessment")}n("Assessment created successfully!",{variant:"success"}),O("/assessments")}catch(t){console.error("Error saving assessment:",t),n(`Failed to save assessment: ${t.message}`,{variant:"error",autoHideDuration:5e3})}finally{y(!1)}}};return e.jsxs(F,{elevation:2,sx:{p:3,borderRadius:2},children:[e.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,color:"primary",children:"Create New Assessment"}),e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(p,{label:"Assessment Title",fullWidth:!0,value:h,onChange:t=>D(t.target.value),required:!0,helperText:"Provide a clear, descriptive title."})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(p,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:b,onChange:t=>z(t.target.value),helperText:"Include instructions or context for the assessor/candidate."})})]}),e.jsx(W,{sx:{my:3}}),e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Questions"}),e.jsx(H,{children:a.map((t,s)=>e.jsx(L,{divider:!0,sx:{p:2,mb:2,borderLeft:"4px solid",borderColor:"primary.main",backgroundColor:"background.paper"},children:e.jsxs(l,{sx:{width:"100%"},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsxs(d,{variant:"subtitle1",color:"primary",children:["Question ",s+1]}),e.jsx(w,{color:"error",onClick:()=>M(s),disabled:a.length<=1,children:e.jsx(A,{})})]}),e.jsx(p,{label:"Question Text",fullWidth:!0,value:t.text,onChange:r=>x(s,"text",r.target.value),required:!0,sx:{mb:2}}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsxs(C,{fullWidth:!0,required:!0,children:[e.jsx(S,{id:`q-type-label-${s}`,children:"Question Type"}),e.jsx(Q,{labelId:`q-type-label-${s}`,value:t.type,label:"Question Type",onChange:r=>x(s,"type",r.target.value),children:U.map(r=>e.jsx(g,{value:r.value,children:r.label},r.value))})]})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsxs(C,{fullWidth:!0,required:!0,children:[e.jsx(S,{id:`q-required-label-${s}`,children:"Required Status"}),e.jsxs(Q,{labelId:`q-required-label-${s}`,value:t.required,label:"Required Status",onChange:r=>x(s,"required",r.target.value),children:[e.jsx(g,{value:!0,children:"Required"}),e.jsx(g,{value:!1,children:"Optional"})]})]})})]}),t.type==="multiple_choice"&&e.jsxs(l,{sx:{mt:2,p:2,border:"1px dashed",borderColor:"divider",borderRadius:1},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Options (Min: 2)"}),t.options.map((r,i)=>e.jsxs(l,{sx:{display:"flex",gap:1,mb:1},children:[e.jsx(p,{value:r.text,onChange:v=>P(s,i,v.target.value),fullWidth:!0,size:"small",required:!0,label:`Option ${i+1}`}),e.jsx(w,{color:"error",onClick:()=>R(s,i),disabled:t.options.length<=2,children:e.jsx(A,{fontSize:"small"})})]},r.id)),e.jsx(j,{variant:"outlined",size:"small",onClick:()=>B(s),startIcon:e.jsx(T,{}),disabled:t.options.length>=10,sx:{mt:1},children:"Add Option"})]})]})},t.id))}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(j,{variant:"contained",onClick:$,startIcon:e.jsx(T,{}),disabled:a.length>=50,children:"Add Question"}),e.jsx(j,{variant:"contained",color:"primary",onClick:q,disabled:m,startIcon:!m&&e.jsx(I,{}),sx:{minWidth:150},children:m?e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{size:20,color:"inherit"}),"Saving..."]}):"Save Assessment"})]})]})}J.propTypes={organizationId:V.string.isRequired};export{J as default};
