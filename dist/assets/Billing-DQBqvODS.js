import{a as C,g as R,r as d,u as $,_ as k,b as u,j as t,s as B,d as S,f as M,N as E,ag as W,B as f,m as g,t as p,L as G,n as J,o as X,C as K,D as Q,p as P}from"./index-Bxr5mO_H.js";import{u as V}from"./notistack.esm-2ii-TFc-.js";import{A as N}from"./Alert-CSFYCpaa.js";import{a as Y,b as _,T as v}from"./TableCell-B__oVtiF.js";import{G as H}from"./Grid-C4lt9ccn.js";import{C as Z,a as I}from"./CardContent-BvjLlqRG.js";import{C as ee}from"./Chip-DFiwUXPP.js";import"./useSlot-CL1GQppj.js";function te(e){return C("MuiTable",e)}R("MuiTable",["root","stickyHeader"]);const oe=["className","component","padding","size","stickyHeader"],se=e=>{const{classes:o,stickyHeader:s}=e;return M({root:["root",s&&"stickyHeader"]},te,o)},ae=B("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:s}=e;return[o.root,s.stickyHeader&&o.stickyHeader]}})(({theme:e,ownerState:o})=>u({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":u({},e.typography.body2,{padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"})},o.stickyHeader&&{borderCollapse:"separate"})),U="table",re=d.forwardRef(function(o,s){const a=$({props:o,name:"MuiTable"}),{className:i,component:r=U,padding:l="normal",size:n="medium",stickyHeader:c=!1}=a,h=k(a,oe),x=u({},a,{component:r,padding:l,size:n,stickyHeader:c}),b=se(x),j=d.useMemo(()=>({padding:l,size:n,stickyHeader:c}),[l,n,c]);return t.jsx(Y.Provider,{value:j,children:t.jsx(ae,u({as:r,role:r===U?null:"table",ref:s,className:S(b.root,i),ownerState:x},h))})});function ne(e){return C("MuiTableBody",e)}R("MuiTableBody",["root"]);const ie=["className","component"],le=e=>{const{classes:o}=e;return M({root:["root"]},ne,o)},ce=B("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(e,o)=>o.root})({display:"table-row-group"}),de={variant:"body"},z="tbody",pe=d.forwardRef(function(o,s){const a=$({props:o,name:"MuiTableBody"}),{className:i,component:r=z}=a,l=k(a,ie),n=u({},a,{component:r}),c=le(n);return t.jsx(_.Provider,{value:de,children:t.jsx(ce,u({className:S(c.root,i),as:r,ref:s,role:r===z?null:"rowgroup",ownerState:n},l))})});function ue(e){return C("MuiTableHead",e)}R("MuiTableHead",["root"]);const he=["className","component"],me=e=>{const{classes:o}=e;return M({root:["root"]},ue,o)},xe=B("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(e,o)=>o.root})({display:"table-header-group"}),be={variant:"head"},D="thead",ye=d.forwardRef(function(o,s){const a=$({props:o,name:"MuiTableHead"}),{className:i,component:r=D}=a,l=k(a,he),n=u({},a,{component:r}),c=me(n);return t.jsx(_.Provider,{value:be,children:t.jsx(xe,u({as:r,className:S(c.root,i),ref:s,role:r===D?null:"rowgroup",ownerState:n},l))})});function fe(e){return C("MuiTableRow",e)}const O=R("MuiTableRow",["root","selected","hover","head","footer"]),ge=["className","component","hover","selected"],ve=e=>{const{classes:o,selected:s,hover:a,head:i,footer:r}=e;return M({root:["root",s&&"selected",a&&"hover",i&&"head",r&&"footer"]},fe,o)},je=B("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:s}=e;return[o.root,s.head&&o.head,s.footer&&o.footer]}})(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${O.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${O.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:E.alpha(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:E.alpha(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity)}}})),A="tr",L=d.forwardRef(function(o,s){const a=$({props:o,name:"MuiTableRow"}),{className:i,component:r=A,hover:l=!1,selected:n=!1}=a,c=k(a,ge),h=d.useContext(_),x=u({},a,{component:r,hover:l,selected:n,head:h&&h.variant==="head",footer:h&&h.variant==="footer"}),b=ve(x);return t.jsx(je,u({as:r,ref:s,className:S(b.root,i),role:r===A?null:"row",ownerState:x},c))});function q({records:e=[]}){return e.length?t.jsxs(f,{sx:{p:2},children:[t.jsx(g,{variant:"h6",color:"primary",gutterBottom:!0,children:"Billing History"}),t.jsxs(re,{size:"small",children:[t.jsx(ye,{children:t.jsxs(L,{children:[t.jsx(v,{children:"Date"}),t.jsx(v,{children:"Plan"}),t.jsx(v,{align:"right",children:"Amount"})]})}),t.jsx(pe,{children:e.map((o,s)=>t.jsxs(L,{children:[t.jsx(v,{children:new Date(o.date).toLocaleDateString()}),t.jsx(v,{children:o.plan}),t.jsxs(v,{align:"right",children:["$",o.amount]})]},s))})]})]}):t.jsx(N,{severity:"info",sx:{mt:2},children:"No billing records found."})}q.propTypes={records:p.arrayOf(p.shape({date:p.string.isRequired,plan:p.string.isRequired,amount:p.number.isRequired}))};const we=W.memo(q);function F({methods:e=[]}){return e.length?t.jsxs(f,{sx:{p:2},children:[t.jsx(g,{variant:"h6",color:"primary",gutterBottom:!0,children:"Payment Methods"}),t.jsx(G,{dense:!0,children:e.map((o,s)=>t.jsx(J,{children:t.jsx(X,{primary:`${o.brand.toUpperCase()} •••• ${o.last4}`,secondary:`Expires ${o.exp_month}/${o.exp_year}`})},s))})]}):t.jsx(N,{severity:"info",sx:{mt:2},children:"No payment methods saved."})}F.propTypes={methods:p.arrayOf(p.shape({brand:p.string,last4:p.string,exp_month:p.number,exp_year:p.number}))};const Te=W.memo(F);function Ce({orgId:e}){const[o,s]=d.useState(null),[a,i]=d.useState(!0),[r,l]=d.useState(null),{enqueueSnackbar:n}=V(),c=d.useCallback(async y=>{try{const m=localStorage.getItem("token");if(!m)throw new Error("Authentication token not found");const w=await fetch("/api/billing/checkout-session",{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({orgId:e,priceId:y,successUrl:`${window.location.origin}/organization/${e}/billing?success=true`,cancelUrl:`${window.location.origin}/organization/${e}/billing?canceled=true`})}),T=await w.json();if(!w.ok)throw new Error(T.message||"Failed to create checkout session");window.location.href=T.url}catch(m){console.error("Checkout error:",m),n(m.message||"Failed to start checkout process.",{variant:"error",autoHideDuration:5e3,anchorOrigin:{vertical:"top",horizontal:"right"}}),i(!1)}},[e,n]),h=d.useCallback(async()=>{i(!0),l(null);try{const y=localStorage.getItem("token");if(!y)throw new Error("Authentication token not found");const m=await fetch(`/api/organizations/${e}`,{method:"GET",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}});if(!m.ok){const T=await m.json();throw new Error(T.message||"Failed to fetch organization data")}const w=await m.json();s(w)}catch(y){console.error("Fetch organization data error:",y),l(y.message)}finally{i(!1)}},[e]);if(d.useEffect(()=>{h()},[h]),r)return t.jsxs(N,{severity:"error",sx:{m:2},children:["Error loading organization data: ",r]});if(a||!o)return t.jsx(f,{sx:{display:"flex",justifyContent:"center",p:4},children:t.jsx(K,{})});const x=o.subscription?.status||"inactive",b=x==="active",j=o.subscription?.currentPeriodEnd?new Date(o.subscription.currentPeriodEnd):null;return t.jsxs(f,{sx:{p:3,maxWidth:"100%",overflowX:"hidden"},children:[t.jsx(g,{variant:"h4",gutterBottom:!0,fontWeight:"bold",children:"Billing & Subscription"}),t.jsxs(H,{container:!0,spacing:3,children:[t.jsxs(H,{item:!0,xs:12,md:8,children:[t.jsx(Z,{elevation:2,sx:{borderRadius:2},children:t.jsxs(I,{children:[t.jsx(g,{variant:"h6",gutterBottom:!0,children:"Current Plan"}),t.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(g,{variant:"body1",component:"span",children:o.subscription?.plan||"Free Tier"}),t.jsx(ee,{label:x,color:b?"success":"default",variant:"outlined",size:"small",sx:{textTransform:"capitalize"}})]}),j&&t.jsxs(g,{variant:"body2",color:"text.secondary",children:[b?"Renews":"Expires"," on: ",j.toLocaleDateString()]}),!o.subscription&&t.jsx(g,{variant:"body2",color:"text.secondary",children:"No active subscription found."}),t.jsx(Q,{sx:{my:3}}),t.jsxs(f,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[t.jsx(P,{variant:"contained",color:"primary",onClick:()=>c("price_premium_id_placeholder"),disabled:a||b,sx:{minWidth:180},children:"Upgrade to Premium"}),t.jsx(P,{variant:"outlined",color:"primary",onClick:()=>c("price_enterprise_id_placeholder"),disabled:a,sx:{minWidth:180},children:"Contact Sales"})]})]})}),t.jsx(f,{sx:{mt:3},children:t.jsx(we,{orgId:e})})]}),t.jsx(H,{item:!0,xs:12,md:4,children:t.jsx(Te,{orgId:e})})]})]})}Ce.propTypes={orgId:p.string.isRequired};export{Ce as default};
